# /project:setup

Analyzes the current project and generates or updates the `CLAUDE.md` file with comprehensive context from installed marketplace plugins.

## What It Does

This command follows the enhanced **[CLAUDE.md Setup Workflow](../workflows/claude-md-setup.md)** which:

1. **Discovers all marketplace plugins** - Scans plugin directories for `plugin.json` metadata
2. **Analyzes project dependencies** - Reads `package.json`, lockfiles, and config files
3. **Matches technologies to plugins** - Uses plugin keywords and descriptions
4. **Extracts skill metadata** - Reads `SKILL.md` frontmatter for descriptions and updates
5. **Extracts critical rules** - Finds NEVER/MUST/ALWAYS patterns from skill documentation
6. **Extracts version context** - Captures breaking changes and new features
7. **Extracts CLAUDE-specific sections** - Finds sections marked for CLAUDE.md inclusion
8. **Resolves template variables** - Resolves `[package-manager]`, `[test-script]`, etc. against project
9. **Generates comprehensive CLAUDE.md** - Creates or updates with all extracted context

## Enhanced Features (New)

The enhanced workflow now extracts from each matched skill:

| Extraction Type | Source | Output in CLAUDE.md |
|----------------|--------|---------------------|
| **Frontmatter** | SKILL.md YAML frontmatter | Skill descriptions, last updated dates |
| **Critical Rules** | NEVER/MUST/ALWAYS patterns | Aggregated critical rules section |
| **Version Context** | Breaking changes sections | Version notes with migration guides |
| **CLAUDE Sections** | "For CLAUDE.md" headings | Skill-specific guidance |
| **Code Patterns** | ❌ WRONG vs ✅ CORRECT examples | Best practice examples |
| **Template Variables** | `[package-manager]` etc. in skills | Resolved Variables section |

## When to Use

- **Starting a new project** - Generate initial CLAUDE.md with all relevant context
- **Adding new technologies** - Update CLAUDE.md after adding dependencies
- **Onboarding** - Help Claude understand the project structure quickly
- **Project evolution** - Keep CLAUDE.md in sync as the project grows

## Usage

```bash
/project:setup
```

## Generated CLAUDE.md Structure

The enhanced workflow generates:

```markdown
# [Project Name]

[Project description]

## Tech Stack
[Categorized technologies with versions]

## Package Manager
[Detected package manager]

## Resolved Variables
[Template variables resolved to project-specific values]

## Critical Rules
[Extracted NEVER/MUST/ALWAYS rules from all skills]

## Marketplace Plugins
[Matched plugins table]

### Available Skills
[Skills with descriptions from frontmatter]

### Skill-Specific Guidance
[Extracted CLAUDE-specific sections from skills]

## Workflows
[Available workflows]

## Commands
[Available commands]

## Quality Gates
[Detected validation commands]

## Version Notes
[Breaking changes and new features by version]

## Git & Commit Conventions
[Standard conventions]

## Development Notes
[User-preserved content]
```

## Example Output

### Skills Table (with frontmatter)

| Skill | Plugin | Purpose | Updated |
|-------|--------|---------|---------|
| `latest-nextjs` | nextjs | Latest Next.js 16 features, App Router, Server Components | 2026-01-11 |
| `playwright-test` | playwright | E2E testing patterns, fixtures, page objects, accessibility | 2026-01-11 |

### Critical Rules (extracted from skills)

```markdown
## Critical Rules

### Playwright Testing
- **CRITICAL**: Base URLs configured in config files, never in test files
- **NEVER** add `webServer` configuration - server is managed externally
- **ALWAYS** use root-relative paths (e.g., `await page.goto("/")`)

### Next.js Development
- **NEVER** edit `*/generated/` files - auto-generated by GraphQL codegen
- **MUST** use `.role.graphql` naming for GraphQL documents
```

### Resolved Variables (template variables from skills)

```markdown
## Resolved Variables

Skills use template variables that are resolved for this project:

| Variable | Value | Source |
|----------|-------|--------|
| `package-manager` | `pnpm` | Detected from pnpm-lock.yaml |
| `test-script` | `test` | Found in package.json scripts |
| `test:e2e-script` | `test:e2e` | Found in package.json scripts |
| `dev-script` | `dev` | Found in package.json scripts |
| `build-script` | `build` | Found in package.json scripts |
| `lint-script` | `lint` | Found in package.json scripts |
| `dev-port` | `3000` | Next.js default |

**Usage:** When a skill says `[package-manager] run [test-script]`, use `pnpm run test` for this project.
```

### Version Notes (extracted from skills)

```markdown
## Version Notes

### Next.js 16

**Breaking Changes:**
- Route parameters are now async - use `await params.id`
- `middleware.ts` renamed to `proxy.ts`

**Migration:**
```bash
npx @next/codemod@canary middleware-to-proxy
```
```

## Notes

- **Plugin discovery is dynamic** - No technologies are hardcoded
- **Matching uses keywords** - Plugins matched via `plugin.json` keywords and descriptions
- **Preserves user content** - Custom sections maintained during updates
- **Works with any marketplace** - Generic plugin discovery pattern

See the full [workflow documentation](../workflows/claude-md-setup.md) for implementation details.
